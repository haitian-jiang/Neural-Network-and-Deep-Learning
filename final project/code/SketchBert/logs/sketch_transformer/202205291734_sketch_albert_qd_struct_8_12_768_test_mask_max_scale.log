2022-05-29 17:34:48,578 - main.py[line:53] - INFO: {trainer: sketch_transformer, batch_size: 10, num_iterations: 200000, num_epoch: 100, learning_rate: 0.0001, gpu_ids: [0], task_types: ['sketchclsinput'], get_type: single, mask_task_type: task, load_pretrained: pretrained, which_pretrained: ['enc_net'], restore_checkpoint_path: model_logs/sketch_transformer/202205231430_sketch_albert_qd_struct_8_12_768_test_mask_max_scale/best_ckpt.pth.tar, dataset: quickdraw_memmap, num_train_samples: 20000000, num_val_samples: 10, num_display_samples: 10, shuffle_val: False, loader_num_workers: 4, sum_path: Oracle3/memmap_sum.txt, offset_path: Oracle3/offsets.npz, cls_limit_path: , mode: train, max_length: 250, max_size: [128, 128], image_size: 224, type_size: 3, mask_prob: 0.85, limit: 1000, stroke_type: stroke-5, input_is_complete: False, max_cls_cache: 345, normalization_type: max_scale, max_scale_factor: 10, each_max_samples: 5000, each_image_max_samples: 100, each_val_samples: 1000, print_every: 100, log_dir: sketch_albert_qd_struct_8_12_768_test_mask_max_scale, checkpoint_every: 2000, save_model_every: 2000, encoder_type: Ori, layers_setting: [[12, 768, 3072], [12, 768, 3072], [12, 768, 3072], [12, 768, 3072], [12, 768, 3072], [12, 768, 3072], [12, 768, 3072], [12, 768, 3072]], output_attentions: False, output_all_states: False, keep_multihead_output: False, input_dim: 5, cls_dim: 345, latent_dim: 128, rel_feat_dim: 128, M: 16, embed_layers_setting: [128, 256, 512], rel_layers_setting: [], cls_layers_setting: [512], rec_layers_setting: [512, 256, 128], sketch_embed_type: linear, embed_pool_type: sum, model_type: albert, position_type: learn, segment_type: none, atten_type: single, attention_norm_type: LN, inter_activation: gelu, attention_dropout_prob: 0.5, hidden_dropout_prob: 0.5, output_dropout_prob: 0.5, triplet_margin: 2.0, gamma: 0.1, mask_gmm_weight: 1, rec_gmm_weight: 0, mask_axis_weight: 1, rec_axis_weight: 0, mask_type_weight: 1, rec_type_weight: 0, prediction_weight: 1, triplet_weight: 1, }
2022-05-29 17:34:48,578 - main.py[line:56] - INFO: Initialize the dataset...
2022-05-29 17:34:48,585 - __init__.py[line:257] - INFO: There are 60 iterations per epoch
2022-05-29 17:34:48,586 - __init__.py[line:258] - INFO: Training dataset has 600 images.
2022-05-29 17:34:48,594 - __init__.py[line:265] - INFO: Val dataset has 4600 images.
2022-05-29 17:34:48,960 - main.py[line:66] - INFO: Finish the dataset initialization.
2022-05-29 17:34:48,971 - trainer.py[line:56] - INFO: Defining Network Structure...
2022-05-29 17:34:49,048 - trainer.py[line:69] - INFO: Sketch Transformer Sturture:
SketchTransformerModel(
  (embedding): SketchEmbedding(
    (embedding): Linear(in_features=5, out_features=128, bias=True)
  )
  (pos_embedding): SketchLearnPositionEmbedding(
    (pos_embedding): Embedding(251, 128)
  )
  (embed_refine_net): SketchEmbeddingRefineNetwork(
    (layers): ModuleList(
      (0): Linear(in_features=128, out_features=256, bias=True)
      (1): Linear(in_features=256, out_features=512, bias=True)
      (2): Linear(in_features=512, out_features=768, bias=True)
    )
  )
  (encoder): SketchALEncoder(
    (sketch_layer): SketchLayer(
      (attention): SketchMultiHeadAttention(
        (attention): SketchSelfAttention(
          (query): Linear(in_features=768, out_features=768, bias=True)
          (key): Linear(in_features=768, out_features=768, bias=True)
          (value): Linear(in_features=768, out_features=768, bias=True)
          (dropout): Dropout(p=0.5, inplace=False)
        )
        (output): SketchOutput(
          (fc): Linear(in_features=768, out_features=768, bias=True)
          (norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          (dropout): Dropout(p=0.5, inplace=False)
        )
      )
      (inter_layer): SketchIntermediate(
        (fc): Linear(in_features=768, out_features=3072, bias=True)
      )
      (output): SketchOutput(
        (fc): Linear(in_features=3072, out_features=768, bias=True)
        (norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
        (dropout): Dropout(p=0.5, inplace=False)
      )
    )
  )
)
2022-05-29 17:34:54,146 - trainer.py[line:88] - INFO: Finish Construction of Networks.
2022-05-29 17:34:54,147 - trainer.py[line:100] - INFO: Finish Construction of Optimizers.
2022-05-29 17:34:54,147 - trainer.py[line:103] - INFO: Defining Losses...
2022-05-29 17:34:54,148 - trainer.py[line:108] - INFO: Finish Losses.
2022-05-29 17:34:54,148 - trainer.py[line:133] - INFO: Restoring from checkpoint:model_logs/sketch_transformer/202205231430_sketch_albert_qd_struct_8_12_768_test_mask_max_scale/best_ckpt.pth.tar
2022-05-29 17:34:54,239 - trainer.py[line:137] - INFO: Restoring netE
2022-05-29 17:35:06,692 - trainer.py[line:569] - INFO: Train Epoch 2, Time:0.102[T:0.099/D:0.003], Total Iter [100/200000], [40/60]:Losses:[train_prediction]:5.0019
2022-05-29 17:35:17,652 - trainer.py[line:569] - INFO: Train Epoch 4, Time:0.103[T:0.100/D:0.003], Total Iter [200/200000], [20/60]:Losses:[train_prediction]:4.2743
2022-05-29 17:35:28,259 - trainer.py[line:569] - INFO: Train Epoch 5, Time:0.100[T:0.098/D:0.003], Total Iter [300/200000], [60/60]:Losses:[train_prediction]:3.9371
2022-05-29 17:35:39,208 - trainer.py[line:569] - INFO: Train Epoch 7, Time:0.101[T:0.098/D:0.003], Total Iter [400/200000], [40/60]:Losses:[train_prediction]:2.9032
2022-05-29 17:35:50,155 - trainer.py[line:569] - INFO: Train Epoch 9, Time:0.101[T:0.099/D:0.003], Total Iter [500/200000], [20/60]:Losses:[train_prediction]:2.8804
2022-05-29 17:36:00,887 - trainer.py[line:569] - INFO: Train Epoch 10, Time:0.101[T:0.099/D:0.003], Total Iter [600/200000], [60/60]:Losses:[train_prediction]:2.1928
2022-05-29 17:36:11,915 - trainer.py[line:569] - INFO: Train Epoch 12, Time:0.101[T:0.099/D:0.003], Total Iter [700/200000], [40/60]:Losses:[train_prediction]:1.8385
2022-05-29 17:36:22,864 - trainer.py[line:569] - INFO: Train Epoch 14, Time:0.102[T:0.099/D:0.003], Total Iter [800/200000], [20/60]:Losses:[train_prediction]:1.5965
2022-05-29 17:36:33,467 - trainer.py[line:569] - INFO: Train Epoch 15, Time:0.102[T:0.099/D:0.003], Total Iter [900/200000], [60/60]:Losses:[train_prediction]:1.4137
2022-05-29 17:36:44,439 - trainer.py[line:569] - INFO: Train Epoch 17, Time:0.102[T:0.099/D:0.003], Total Iter [1000/200000], [40/60]:Losses:[train_prediction]:1.1439
2022-05-29 17:36:55,679 - trainer.py[line:569] - INFO: Train Epoch 19, Time:0.102[T:0.099/D:0.003], Total Iter [1100/200000], [20/60]:Losses:[train_prediction]:1.3422
2022-05-29 17:37:06,333 - trainer.py[line:569] - INFO: Train Epoch 20, Time:0.104[T:0.099/D:0.005], Total Iter [1200/200000], [60/60]:Losses:[train_prediction]:0.9715
2022-05-29 17:37:17,457 - trainer.py[line:569] - INFO: Train Epoch 22, Time:0.101[T:0.098/D:0.003], Total Iter [1300/200000], [40/60]:Losses:[train_prediction]:0.9920
2022-05-29 17:37:28,500 - trainer.py[line:569] - INFO: Train Epoch 24, Time:0.105[T:0.102/D:0.003], Total Iter [1400/200000], [20/60]:Losses:[train_prediction]:0.5672
2022-05-29 17:37:39,130 - trainer.py[line:569] - INFO: Train Epoch 25, Time:0.101[T:0.098/D:0.003], Total Iter [1500/200000], [60/60]:Losses:[train_prediction]:0.5922
2022-05-29 17:37:50,122 - trainer.py[line:569] - INFO: Train Epoch 27, Time:0.115[T:0.099/D:0.016], Total Iter [1600/200000], [40/60]:Losses:[train_prediction]:0.2861
2022-05-29 17:38:01,082 - trainer.py[line:569] - INFO: Train Epoch 29, Time:0.101[T:0.098/D:0.003], Total Iter [1700/200000], [20/60]:Losses:[train_prediction]:0.4397
2022-05-29 17:38:11,623 - trainer.py[line:569] - INFO: Train Epoch 30, Time:0.103[T:0.100/D:0.003], Total Iter [1800/200000], [60/60]:Losses:[train_prediction]:0.3156
2022-05-29 17:38:22,570 - trainer.py[line:569] - INFO: Train Epoch 32, Time:0.100[T:0.098/D:0.003], Total Iter [1900/200000], [40/60]:Losses:[train_prediction]:0.5798
2022-05-29 17:38:33,536 - trainer.py[line:569] - INFO: Train Epoch 34, Time:0.102[T:0.099/D:0.003], Total Iter [2000/200000], [20/60]:Losses:[train_prediction]:0.1264
2022-05-29 17:38:50,170 - trainer.py[line:569] - INFO: Validate Epoch 34, Time:16.534[T:0.032/D:16.502], Total Iter [2000/200000], [20/60]:Losses:[val_prediction]:4.6442; Evaluations:[val_accuracy_1]:0.2665, [val_accuracy_5]:0.4380
2022-05-29 17:38:50,173 - trainer.py[line:530] - INFO: Saving checkpoint to model_logs/sketch_transformer/202205291734_sketch_albert_qd_struct_8_12_768_test_mask_max_scale/latest_ckpt.pth.tar
2022-05-29 17:38:51,178 - trainer.py[line:530] - INFO: Saving checkpoint to model_logs/sketch_transformer/202205291734_sketch_albert_qd_struct_8_12_768_test_mask_max_scale/best_ckpt.pth.tar
2022-05-29 17:38:52,187 - trainer.py[line:530] - INFO: Saving checkpoint to model_logs/sketch_transformer/202205291734_sketch_albert_qd_struct_8_12_768_test_mask_max_scale/iter_2000_ckpt.pth.tar
2022-05-29 17:39:03,839 - trainer.py[line:569] - INFO: Train Epoch 35, Time:0.103[T:0.100/D:0.003], Total Iter [2100/200000], [60/60]:Losses:[train_prediction]:0.2323
2022-05-29 17:39:15,004 - trainer.py[line:569] - INFO: Train Epoch 37, Time:0.105[T:0.102/D:0.003], Total Iter [2200/200000], [40/60]:Losses:[train_prediction]:0.6081
2022-05-29 17:39:26,262 - trainer.py[line:569] - INFO: Train Epoch 39, Time:0.102[T:0.099/D:0.003], Total Iter [2300/200000], [20/60]:Losses:[train_prediction]:0.5003
2022-05-29 17:39:37,005 - trainer.py[line:569] - INFO: Train Epoch 40, Time:0.101[T:0.098/D:0.003], Total Iter [2400/200000], [60/60]:Losses:[train_prediction]:0.3721
2022-05-29 17:39:47,998 - trainer.py[line:569] - INFO: Train Epoch 42, Time:0.103[T:0.100/D:0.003], Total Iter [2500/200000], [40/60]:Losses:[train_prediction]:0.5620
2022-05-29 17:39:59,004 - trainer.py[line:569] - INFO: Train Epoch 44, Time:0.102[T:0.099/D:0.003], Total Iter [2600/200000], [20/60]:Losses:[train_prediction]:0.1632
2022-05-29 17:40:09,694 - trainer.py[line:569] - INFO: Train Epoch 45, Time:0.102[T:0.099/D:0.003], Total Iter [2700/200000], [60/60]:Losses:[train_prediction]:0.2210
2022-05-29 17:40:20,693 - trainer.py[line:569] - INFO: Train Epoch 47, Time:0.101[T:0.098/D:0.003], Total Iter [2800/200000], [40/60]:Losses:[train_prediction]:0.4058
2022-05-29 17:40:31,616 - trainer.py[line:569] - INFO: Train Epoch 49, Time:0.101[T:0.098/D:0.003], Total Iter [2900/200000], [20/60]:Losses:[train_prediction]:0.5293
2022-05-29 17:40:42,162 - trainer.py[line:569] - INFO: Train Epoch 50, Time:0.101[T:0.098/D:0.003], Total Iter [3000/200000], [60/60]:Losses:[train_prediction]:0.4172
2022-05-29 17:40:53,235 - trainer.py[line:569] - INFO: Train Epoch 52, Time:0.101[T:0.099/D:0.003], Total Iter [3100/200000], [40/60]:Losses:[train_prediction]:0.1119
2022-05-29 17:41:04,354 - trainer.py[line:569] - INFO: Train Epoch 54, Time:0.101[T:0.098/D:0.003], Total Iter [3200/200000], [20/60]:Losses:[train_prediction]:0.2236
2022-05-29 17:41:15,018 - trainer.py[line:569] - INFO: Train Epoch 55, Time:0.103[T:0.100/D:0.003], Total Iter [3300/200000], [60/60]:Losses:[train_prediction]:0.0857
2022-05-29 17:41:26,139 - trainer.py[line:569] - INFO: Train Epoch 57, Time:0.102[T:0.099/D:0.003], Total Iter [3400/200000], [40/60]:Losses:[train_prediction]:0.1675
2022-05-29 17:41:37,234 - trainer.py[line:569] - INFO: Train Epoch 59, Time:0.101[T:0.099/D:0.003], Total Iter [3500/200000], [20/60]:Losses:[train_prediction]:0.4036
2022-05-29 17:41:47,857 - trainer.py[line:569] - INFO: Train Epoch 60, Time:0.103[T:0.100/D:0.003], Total Iter [3600/200000], [60/60]:Losses:[train_prediction]:1.0280
2022-05-29 17:41:58,883 - trainer.py[line:569] - INFO: Train Epoch 62, Time:0.101[T:0.098/D:0.003], Total Iter [3700/200000], [40/60]:Losses:[train_prediction]:0.1788
2022-05-29 17:42:09,974 - trainer.py[line:569] - INFO: Train Epoch 64, Time:0.103[T:0.100/D:0.003], Total Iter [3800/200000], [20/60]:Losses:[train_prediction]:0.6001
2022-05-29 17:42:20,602 - trainer.py[line:569] - INFO: Train Epoch 65, Time:0.101[T:0.098/D:0.003], Total Iter [3900/200000], [60/60]:Losses:[train_prediction]:0.0298
2022-05-29 17:42:31,711 - trainer.py[line:569] - INFO: Train Epoch 67, Time:0.105[T:0.102/D:0.003], Total Iter [4000/200000], [40/60]:Losses:[train_prediction]:0.1352
2022-05-29 17:42:48,731 - trainer.py[line:569] - INFO: Validate Epoch 67, Time:16.865[T:0.033/D:16.832], Total Iter [4000/200000], [40/60]:Losses:[val_prediction]:5.7322; Evaluations:[val_accuracy_1]:0.2339, [val_accuracy_5]:0.4080
2022-05-29 17:42:48,735 - trainer.py[line:530] - INFO: Saving checkpoint to model_logs/sketch_transformer/202205291734_sketch_albert_qd_struct_8_12_768_test_mask_max_scale/latest_ckpt.pth.tar
2022-05-29 17:42:49,766 - trainer.py[line:530] - INFO: Saving checkpoint to model_logs/sketch_transformer/202205291734_sketch_albert_qd_struct_8_12_768_test_mask_max_scale/iter_4000_ckpt.pth.tar
2022-05-29 17:43:01,827 - trainer.py[line:569] - INFO: Train Epoch 69, Time:0.102[T:0.100/D:0.003], Total Iter [4100/200000], [20/60]:Losses:[train_prediction]:0.0172
2022-05-29 17:43:12,414 - trainer.py[line:569] - INFO: Train Epoch 70, Time:0.102[T:0.099/D:0.003], Total Iter [4200/200000], [60/60]:Losses:[train_prediction]:0.0604
2022-05-29 17:43:23,410 - trainer.py[line:569] - INFO: Train Epoch 72, Time:0.103[T:0.100/D:0.003], Total Iter [4300/200000], [40/60]:Losses:[train_prediction]:0.1089
2022-05-29 17:43:34,638 - trainer.py[line:569] - INFO: Train Epoch 74, Time:0.112[T:0.108/D:0.003], Total Iter [4400/200000], [20/60]:Losses:[train_prediction]:0.0762
2022-05-29 17:43:45,297 - trainer.py[line:569] - INFO: Train Epoch 75, Time:0.101[T:0.098/D:0.003], Total Iter [4500/200000], [60/60]:Losses:[train_prediction]:0.0707
2022-05-29 17:43:56,553 - trainer.py[line:569] - INFO: Train Epoch 77, Time:0.107[T:0.104/D:0.003], Total Iter [4600/200000], [40/60]:Losses:[train_prediction]:0.1114
2022-05-29 17:44:07,780 - trainer.py[line:569] - INFO: Train Epoch 79, Time:0.101[T:0.098/D:0.003], Total Iter [4700/200000], [20/60]:Losses:[train_prediction]:0.3516
2022-05-29 17:44:18,417 - trainer.py[line:569] - INFO: Train Epoch 80, Time:0.105[T:0.102/D:0.003], Total Iter [4800/200000], [60/60]:Losses:[train_prediction]:0.0686
2022-05-29 17:44:29,436 - trainer.py[line:569] - INFO: Train Epoch 82, Time:0.102[T:0.100/D:0.003], Total Iter [4900/200000], [40/60]:Losses:[train_prediction]:0.3671
2022-05-29 17:44:40,416 - trainer.py[line:569] - INFO: Train Epoch 84, Time:0.102[T:0.099/D:0.003], Total Iter [5000/200000], [20/60]:Losses:[train_prediction]:0.0389
2022-05-29 17:44:51,006 - trainer.py[line:569] - INFO: Train Epoch 85, Time:0.101[T:0.099/D:0.003], Total Iter [5100/200000], [60/60]:Losses:[train_prediction]:0.0820
2022-05-29 17:45:01,964 - trainer.py[line:569] - INFO: Train Epoch 87, Time:0.103[T:0.100/D:0.003], Total Iter [5200/200000], [40/60]:Losses:[train_prediction]:0.3180
2022-05-29 17:45:13,140 - trainer.py[line:569] - INFO: Train Epoch 89, Time:0.102[T:0.099/D:0.003], Total Iter [5300/200000], [20/60]:Losses:[train_prediction]:0.0298
2022-05-29 17:45:23,780 - trainer.py[line:569] - INFO: Train Epoch 90, Time:0.105[T:0.102/D:0.003], Total Iter [5400/200000], [60/60]:Losses:[train_prediction]:0.1386
2022-05-29 17:45:35,056 - trainer.py[line:569] - INFO: Train Epoch 92, Time:0.105[T:0.102/D:0.003], Total Iter [5500/200000], [40/60]:Losses:[train_prediction]:0.2904
2022-05-29 17:45:46,173 - trainer.py[line:569] - INFO: Train Epoch 94, Time:0.102[T:0.100/D:0.003], Total Iter [5600/200000], [20/60]:Losses:[train_prediction]:0.4754
2022-05-29 17:45:56,836 - trainer.py[line:569] - INFO: Train Epoch 95, Time:0.101[T:0.098/D:0.003], Total Iter [5700/200000], [60/60]:Losses:[train_prediction]:0.0253
2022-05-29 17:46:07,819 - trainer.py[line:569] - INFO: Train Epoch 97, Time:0.101[T:0.099/D:0.003], Total Iter [5800/200000], [40/60]:Losses:[train_prediction]:0.3546
2022-05-29 17:46:18,846 - trainer.py[line:569] - INFO: Train Epoch 99, Time:0.104[T:0.101/D:0.003], Total Iter [5900/200000], [20/60]:Losses:[train_prediction]:0.0166
2022-05-29 17:46:29,510 - trainer.py[line:569] - INFO: Train Epoch 100, Time:0.101[T:0.099/D:0.003], Total Iter [6000/200000], [60/60]:Losses:[train_prediction]:0.1082
2022-05-29 17:46:46,296 - trainer.py[line:569] - INFO: Validate Epoch 100, Time:16.695[T:0.035/D:16.660], Total Iter [6000/200000], [60/60]:Losses:[val_prediction]:6.0510; Evaluations:[val_accuracy_1]:0.2509, [val_accuracy_5]:0.4107
2022-05-29 17:46:46,300 - trainer.py[line:530] - INFO: Saving checkpoint to model_logs/sketch_transformer/202205291734_sketch_albert_qd_struct_8_12_768_test_mask_max_scale/latest_ckpt.pth.tar
2022-05-29 17:46:47,351 - trainer.py[line:530] - INFO: Saving checkpoint to model_logs/sketch_transformer/202205291734_sketch_albert_qd_struct_8_12_768_test_mask_max_scale/iter_6000_ckpt.pth.tar
