2022-05-29 18:20:13,403 - main.py[line:53] - INFO: {trainer: sketch_transformer, batch_size: 10, num_iterations: 200000, num_epoch: 100, learning_rate: 0.0001, gpu_ids: [0], task_types: ['sketchclsinput'], get_type: single, mask_task_type: task, load_pretrained: pretrained, which_pretrained: ['enc_net'], restore_checkpoint_path: model_logs/sketch_transformer/202205231430_sketch_albert_qd_struct_8_12_768_test_mask_max_scale/best_ckpt.pth.tar, dataset: quickdraw_memmap, num_train_samples: 20000000, num_val_samples: 10, num_display_samples: 10, shuffle_val: False, loader_num_workers: 4, sum_path: Oracle1/memmap_sum.txt, offset_path: Oracle1/offsets.npz, cls_limit_path: , mode: train, max_length: 250, max_size: [128, 128], image_size: 224, type_size: 3, mask_prob: 0.85, limit: 1000, stroke_type: stroke-5, input_is_complete: False, max_cls_cache: 345, normalization_type: max_scale, max_scale_factor: 10, each_max_samples: 5000, each_image_max_samples: 100, each_val_samples: 1000, print_every: 100, log_dir: sketch_albert_qd_struct_8_12_768_test_mask_max_scale, checkpoint_every: 400, save_model_every: 400, encoder_type: Ori, layers_setting: [[12, 768, 3072], [12, 768, 3072], [12, 768, 3072], [12, 768, 3072], [12, 768, 3072], [12, 768, 3072], [12, 768, 3072], [12, 768, 3072]], output_attentions: False, output_all_states: False, keep_multihead_output: False, input_dim: 5, cls_dim: 345, latent_dim: 128, rel_feat_dim: 128, M: 16, embed_layers_setting: [128, 256, 512], rel_layers_setting: [], cls_layers_setting: [512], rec_layers_setting: [512, 256, 128], sketch_embed_type: linear, embed_pool_type: sum, model_type: albert, position_type: learn, segment_type: none, atten_type: single, attention_norm_type: LN, inter_activation: gelu, attention_dropout_prob: 0.5, hidden_dropout_prob: 0.5, output_dropout_prob: 0.5, triplet_margin: 2.0, gamma: 0.1, mask_gmm_weight: 1, rec_gmm_weight: 0, mask_axis_weight: 1, rec_axis_weight: 0, mask_type_weight: 1, rec_type_weight: 0, prediction_weight: 1, triplet_weight: 1, }
2022-05-29 18:20:13,403 - main.py[line:56] - INFO: Initialize the dataset...
2022-05-29 18:20:13,408 - __init__.py[line:257] - INFO: There are 20 iterations per epoch
2022-05-29 18:20:13,408 - __init__.py[line:258] - INFO: Training dataset has 200 images.
2022-05-29 18:20:13,416 - __init__.py[line:265] - INFO: Val dataset has 4200 images.
2022-05-29 18:20:13,739 - main.py[line:66] - INFO: Finish the dataset initialization.
2022-05-29 18:20:13,749 - trainer.py[line:56] - INFO: Defining Network Structure...
2022-05-29 18:20:13,826 - trainer.py[line:69] - INFO: Sketch Transformer Sturture:
SketchTransformerModel(
  (embedding): SketchEmbedding(
    (embedding): Linear(in_features=5, out_features=128, bias=True)
  )
  (pos_embedding): SketchLearnPositionEmbedding(
    (pos_embedding): Embedding(251, 128)
  )
  (embed_refine_net): SketchEmbeddingRefineNetwork(
    (layers): ModuleList(
      (0): Linear(in_features=128, out_features=256, bias=True)
      (1): Linear(in_features=256, out_features=512, bias=True)
      (2): Linear(in_features=512, out_features=768, bias=True)
    )
  )
  (encoder): SketchALEncoder(
    (sketch_layer): SketchLayer(
      (attention): SketchMultiHeadAttention(
        (attention): SketchSelfAttention(
          (query): Linear(in_features=768, out_features=768, bias=True)
          (key): Linear(in_features=768, out_features=768, bias=True)
          (value): Linear(in_features=768, out_features=768, bias=True)
          (dropout): Dropout(p=0.5, inplace=False)
        )
        (output): SketchOutput(
          (fc): Linear(in_features=768, out_features=768, bias=True)
          (norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          (dropout): Dropout(p=0.5, inplace=False)
        )
      )
      (inter_layer): SketchIntermediate(
        (fc): Linear(in_features=768, out_features=3072, bias=True)
      )
      (output): SketchOutput(
        (fc): Linear(in_features=3072, out_features=768, bias=True)
        (norm): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
        (dropout): Dropout(p=0.5, inplace=False)
      )
    )
  )
)
2022-05-29 18:20:19,588 - trainer.py[line:88] - INFO: Finish Construction of Networks.
2022-05-29 18:20:19,590 - trainer.py[line:100] - INFO: Finish Construction of Optimizers.
2022-05-29 18:20:19,590 - trainer.py[line:103] - INFO: Defining Losses...
2022-05-29 18:20:19,591 - trainer.py[line:108] - INFO: Finish Losses.
2022-05-29 18:20:19,591 - trainer.py[line:133] - INFO: Restoring from checkpoint:model_logs/sketch_transformer/202205231430_sketch_albert_qd_struct_8_12_768_test_mask_max_scale/best_ckpt.pth.tar
2022-05-29 18:20:19,696 - trainer.py[line:137] - INFO: Restoring netE
2022-05-29 18:20:34,055 - trainer.py[line:569] - INFO: Train Epoch 5, Time:0.112[T:0.109/D:0.003], Total Iter [100/200000], [20/20]:Losses:[train_prediction]:4.5079
2022-05-29 18:20:46,965 - trainer.py[line:569] - INFO: Train Epoch 10, Time:0.113[T:0.110/D:0.003], Total Iter [200/200000], [20/20]:Losses:[train_prediction]:2.8042
2022-05-29 18:20:59,891 - trainer.py[line:569] - INFO: Train Epoch 15, Time:0.102[T:0.099/D:0.003], Total Iter [300/200000], [20/20]:Losses:[train_prediction]:2.0321
2022-05-29 18:21:13,145 - trainer.py[line:569] - INFO: Train Epoch 20, Time:0.114[T:0.111/D:0.003], Total Iter [400/200000], [20/20]:Losses:[train_prediction]:1.2157
2022-05-29 18:21:29,457 - trainer.py[line:569] - INFO: Validate Epoch 20, Time:16.191[T:0.035/D:16.156], Total Iter [400/200000], [20/20]:Losses:[val_prediction]:4.6893; Evaluations:[val_accuracy_1]:0.1474, [val_accuracy_5]:0.2776
2022-05-29 18:21:29,463 - trainer.py[line:530] - INFO: Saving checkpoint to model_logs/sketch_transformer/202205291820_sketch_albert_qd_struct_8_12_768_test_mask_max_scale/latest_ckpt.pth.tar
2022-05-29 18:21:30,515 - trainer.py[line:530] - INFO: Saving checkpoint to model_logs/sketch_transformer/202205291820_sketch_albert_qd_struct_8_12_768_test_mask_max_scale/best_ckpt.pth.tar
2022-05-29 18:21:31,515 - trainer.py[line:530] - INFO: Saving checkpoint to model_logs/sketch_transformer/202205291820_sketch_albert_qd_struct_8_12_768_test_mask_max_scale/iter_400_ckpt.pth.tar
2022-05-29 18:21:45,579 - trainer.py[line:569] - INFO: Train Epoch 25, Time:0.111[T:0.107/D:0.004], Total Iter [500/200000], [20/20]:Losses:[train_prediction]:0.6719
2022-05-29 18:21:58,501 - trainer.py[line:569] - INFO: Train Epoch 30, Time:0.111[T:0.108/D:0.003], Total Iter [600/200000], [20/20]:Losses:[train_prediction]:0.2863
2022-05-29 18:22:11,338 - trainer.py[line:569] - INFO: Train Epoch 35, Time:0.104[T:0.101/D:0.003], Total Iter [700/200000], [20/20]:Losses:[train_prediction]:0.2313
2022-05-29 18:22:24,693 - trainer.py[line:569] - INFO: Train Epoch 40, Time:0.112[T:0.109/D:0.003], Total Iter [800/200000], [20/20]:Losses:[train_prediction]:0.1917
2022-05-29 18:22:41,043 - trainer.py[line:569] - INFO: Validate Epoch 40, Time:16.265[T:0.035/D:16.230], Total Iter [800/200000], [20/20]:Losses:[val_prediction]:5.1963; Evaluations:[val_accuracy_1]:0.1557, [val_accuracy_5]:0.2869
2022-05-29 18:22:41,047 - trainer.py[line:530] - INFO: Saving checkpoint to model_logs/sketch_transformer/202205291820_sketch_albert_qd_struct_8_12_768_test_mask_max_scale/latest_ckpt.pth.tar
2022-05-29 18:22:42,080 - trainer.py[line:530] - INFO: Saving checkpoint to model_logs/sketch_transformer/202205291820_sketch_albert_qd_struct_8_12_768_test_mask_max_scale/best_ckpt.pth.tar
2022-05-29 18:22:43,092 - trainer.py[line:530] - INFO: Saving checkpoint to model_logs/sketch_transformer/202205291820_sketch_albert_qd_struct_8_12_768_test_mask_max_scale/iter_800_ckpt.pth.tar
2022-05-29 18:22:57,192 - trainer.py[line:569] - INFO: Train Epoch 45, Time:0.107[T:0.104/D:0.003], Total Iter [900/200000], [20/20]:Losses:[train_prediction]:0.0897
2022-05-29 18:23:10,419 - trainer.py[line:569] - INFO: Train Epoch 50, Time:0.107[T:0.103/D:0.004], Total Iter [1000/200000], [20/20]:Losses:[train_prediction]:0.1153
2022-05-29 18:23:23,655 - trainer.py[line:569] - INFO: Train Epoch 55, Time:0.113[T:0.110/D:0.003], Total Iter [1100/200000], [20/20]:Losses:[train_prediction]:0.1871
2022-05-29 18:23:36,890 - trainer.py[line:569] - INFO: Train Epoch 60, Time:0.112[T:0.109/D:0.003], Total Iter [1200/200000], [20/20]:Losses:[train_prediction]:0.0478
2022-05-29 18:23:53,540 - trainer.py[line:569] - INFO: Validate Epoch 60, Time:16.550[T:0.035/D:16.515], Total Iter [1200/200000], [20/20]:Losses:[val_prediction]:5.5844; Evaluations:[val_accuracy_1]:0.1576, [val_accuracy_5]:0.2876
2022-05-29 18:23:53,544 - trainer.py[line:530] - INFO: Saving checkpoint to model_logs/sketch_transformer/202205291820_sketch_albert_qd_struct_8_12_768_test_mask_max_scale/latest_ckpt.pth.tar
2022-05-29 18:23:54,578 - trainer.py[line:530] - INFO: Saving checkpoint to model_logs/sketch_transformer/202205291820_sketch_albert_qd_struct_8_12_768_test_mask_max_scale/best_ckpt.pth.tar
2022-05-29 18:23:55,619 - trainer.py[line:530] - INFO: Saving checkpoint to model_logs/sketch_transformer/202205291820_sketch_albert_qd_struct_8_12_768_test_mask_max_scale/iter_1200_ckpt.pth.tar
2022-05-29 18:24:09,579 - trainer.py[line:569] - INFO: Train Epoch 65, Time:0.109[T:0.105/D:0.003], Total Iter [1300/200000], [20/20]:Losses:[train_prediction]:0.0499
2022-05-29 18:24:22,615 - trainer.py[line:569] - INFO: Train Epoch 70, Time:0.109[T:0.106/D:0.003], Total Iter [1400/200000], [20/20]:Losses:[train_prediction]:0.0335
2022-05-29 18:24:35,601 - trainer.py[line:569] - INFO: Train Epoch 75, Time:0.104[T:0.101/D:0.003], Total Iter [1500/200000], [20/20]:Losses:[train_prediction]:0.0269
2022-05-29 18:24:48,693 - trainer.py[line:569] - INFO: Train Epoch 80, Time:0.101[T:0.098/D:0.003], Total Iter [1600/200000], [20/20]:Losses:[train_prediction]:0.0210
2022-05-29 18:25:04,633 - trainer.py[line:569] - INFO: Validate Epoch 80, Time:15.832[T:0.033/D:15.799], Total Iter [1600/200000], [20/20]:Losses:[val_prediction]:5.8681; Evaluations:[val_accuracy_1]:0.1571, [val_accuracy_5]:0.2864
2022-05-29 18:25:04,638 - trainer.py[line:530] - INFO: Saving checkpoint to model_logs/sketch_transformer/202205291820_sketch_albert_qd_struct_8_12_768_test_mask_max_scale/latest_ckpt.pth.tar
2022-05-29 18:25:05,678 - trainer.py[line:530] - INFO: Saving checkpoint to model_logs/sketch_transformer/202205291820_sketch_albert_qd_struct_8_12_768_test_mask_max_scale/iter_1600_ckpt.pth.tar
2022-05-29 18:25:19,641 - trainer.py[line:569] - INFO: Train Epoch 85, Time:0.107[T:0.104/D:0.003], Total Iter [1700/200000], [20/20]:Losses:[train_prediction]:0.0196
2022-05-29 18:25:32,668 - trainer.py[line:569] - INFO: Train Epoch 90, Time:0.109[T:0.106/D:0.003], Total Iter [1800/200000], [20/20]:Losses:[train_prediction]:0.0148
2022-05-29 18:25:45,611 - trainer.py[line:569] - INFO: Train Epoch 95, Time:0.104[T:0.101/D:0.003], Total Iter [1900/200000], [20/20]:Losses:[train_prediction]:1.3422
2022-05-29 18:25:58,582 - trainer.py[line:569] - INFO: Train Epoch 100, Time:0.109[T:0.103/D:0.006], Total Iter [2000/200000], [20/20]:Losses:[train_prediction]:0.6508
2022-05-29 18:26:14,303 - trainer.py[line:569] - INFO: Validate Epoch 100, Time:15.613[T:0.035/D:15.578], Total Iter [2000/200000], [20/20]:Losses:[val_prediction]:5.9254; Evaluations:[val_accuracy_1]:0.1293, [val_accuracy_5]:0.2593
2022-05-29 18:26:14,307 - trainer.py[line:530] - INFO: Saving checkpoint to model_logs/sketch_transformer/202205291820_sketch_albert_qd_struct_8_12_768_test_mask_max_scale/latest_ckpt.pth.tar
2022-05-29 18:26:15,334 - trainer.py[line:530] - INFO: Saving checkpoint to model_logs/sketch_transformer/202205291820_sketch_albert_qd_struct_8_12_768_test_mask_max_scale/iter_2000_ckpt.pth.tar
